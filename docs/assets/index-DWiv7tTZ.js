(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&t(u)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();const f={mode:"idle",startPosition:null,currentPosition:null,endPosition:null,finalSelection:null,dragOffset:null,resizeHandle:null,hoverHandle:null,isShiftPressed:!1};function h(e,i){const n=(t,o)=>{t||(console.error(`ASSERT FAILED @ ${e}: ${o}`),console.log("State snapshot:",structuredClone(i)),console.trace())};switch(i.mode){case"idle":n(!i.startPosition,"idle: startPosition should be null"),n(!i.currentPosition,"idle: currentPosition should be null");break;case"select":n(!!i.startPosition,"select: missing startPosition"),n(!!i.currentPosition,"select: missing currentPosition"),n(!i.finalSelection,"select: already has finalSelection");break;case"move":n(!!i.finalSelection,"move: missing finalSelection"),n(!!i.dragOffset,"move: missing dragOffset"),n(!i.startPosition,"move: startPosition should be null"),n(!i.currentPosition,"move: currentPosition should be null");break}}function y(e,i){const n=e.getBoundingClientRect();return{x:i.clientX-n.left,y:i.clientY-n.top}}function c(e,i){if(!i)return;const t=new Set(["ns-resize","ew-resize","nwse-resize","nesw-resize","move","default","pointer","crosshair"]).has(e)?e:"default";i.style.cursor!==t&&(i.style.cursor=t)}function z(e,i){const n=Math.min(e.x,i.x),t=Math.min(e.y,i.y),o=Math.abs(e.x-i.x),r=Math.abs(e.y-i.y);return{x:n,y:t,width:o,height:r}}function H(e,i){e.startPosition&&(e.currentPosition=i,e.startPosition&&e.currentPosition&&(e.finalSelection=z(e.startPosition,e.currentPosition)),e.startPosition=null,e.currentPosition=null,e.endPosition=null,e.mode="idle")}const s={antLength:12,antSpacing:16,antSpeed:90,selectionBorderWidth:1,edge:6};function E(e,i){return e.x>=i.x&&e.x<=i.x+i.width&&e.y>=i.y&&e.y<=i.y+i.height}function p(e,i,n){return Math.abs(e-i)<=n}function x(e,i,n,t=0){return e>=i-t&&e<=n+t}function b(e,i){const n=s.edge+s.selectionBorderWidth/2,t=p(e.x,i.x,n),o=p(e.x,i.x+i.width,n),r=p(e.y,i.y,n),u=p(e.y,i.y+i.height,n),l=x(e.y,i.y,i.y+i.height,n),d=x(e.x,i.x,i.x+i.width,n);return t&&r?"top-left":o&&r?"top-right":t&&u?"bottom-left":o&&u?"bottom-right":t&&l?"left":o&&l?"right":r&&d?"top":u&&d?"bottom":null}function O(e,i,n){e.addEventListener("pointercancel",()=>{n.mode="idle",n.dragOffset=null,n.resizeHandle=null}),e.addEventListener("lostpointercapture",()=>{n.mode="idle",n.dragOffset=null,n.resizeHandle=null}),e.style.touchAction="none",window.addEventListener("keydown",t=>{t.key==="Escape"&&(n.mode="idle",n.startPosition=null,n.currentPosition=null,n.finalSelection=null,n.dragOffset=null,n.resizeHandle=null,n.hoverHandle=null,c("default",e),i.clearRect(0,0,e.width,e.height))}),window.addEventListener("keydown",t=>{t.key==="Shift"&&(n.isShiftPressed=!0)}),window.addEventListener("keyup",t=>{t.key==="Shift"&&(n.isShiftPressed=!1)}),e.addEventListener("pointerdown",t=>{e.setPointerCapture(t.pointerId);const o=y(e,t);if(h("on pointerdown: ",n),t.shiftKey&&(n.isShiftPressed=!0),n.finalSelection){const r=b(o,n.finalSelection);if(r){n.mode="resize",n.resizeHandle=r;return}}if(t.shiftKey&&(n.isShiftPressed=!0),n.isShiftPressed&&n.startPosition){const r=Math.min(Math.abs(n.startPosition.x-o.x),Math.abs(n.startPosition.y-o.y));n.currentPosition={x:n.startPosition.x+r*(o.x<n.startPosition.x?-1:1),y:n.startPosition.y+r*(o.y<n.startPosition.y?-1:1)}}if(n.finalSelection&&E(o,n.finalSelection)){n.mode="move",n.dragOffset={x:o.x-n.finalSelection.x,y:o.y-n.finalSelection.y},h("after setting move mode: ",n),c("move",e);return}n.mode="select",n.startPosition=o,n.currentPosition=o,n.finalSelection=null,h("after setting select mode: ",n)}),e.addEventListener("pointermove",t=>{const o=y(e,t);if(n.mode==="idle"&&n.finalSelection){const r=b(o,n.finalSelection);n.hoverHandle=r,r?r.includes("left")||r.includes("right")?c("ew-resize",e):(r.includes("top")||r.includes("bottom"))&&c("ns-resize",e):c("default",e);return}if(n.mode==="resize"&&n.finalSelection&&n.resizeHandle){$(n.finalSelection,o,n.resizeHandle,n.isShiftPressed);return}n.mode==="select"?(n.currentPosition=o,h("during select pointermove: ",n)):n.mode==="move"&&n.finalSelection&&n.dragOffset&&(n.finalSelection.x=o.x-n.dragOffset.x,n.finalSelection.y=o.y-n.dragOffset.y,h("during move pointermove: ",n))}),e.addEventListener("pointerup",t=>{e.releasePointerCapture(t.pointerId);const o=y(e,t);if(n.mode==="resize"){n.mode="idle",n.resizeHandle=null,c("default",e);return}n.mode==="select"&&(H(n,o),h("after finalizeSelect: ",n),c("default",e)),n.mode==="move"&&(n.mode="idle",n.dragOffset=null,h("after exiting move mode: ",n),c("default",e))})}function k(e,i,n){if(!n)return{w:e,h:i};const t=Math.min(Math.abs(e),Math.abs(i));return{w:Math.sign(e)*t,h:Math.sign(i)*t}}function $(e,i,n,t=!1){const o=i.x-e.x,r=i.y-e.y,u=(l,d)=>k(l,d,t);switch(n){case"left":{const l=e.width+(e.x-i.x),{w:d}=u(l,e.height);e.x+=e.width-d,e.width=d;break}case"right":{const{w:l}=u(o,e.height);e.width=l;break}case"top":{const l=e.height+(e.y-i.y),{h:d}=u(e.width,l);e.y+=e.height-d,e.height=d;break}case"bottom":{const{h:l}=u(e.width,r);e.height=l;break}case"top-left":{const l=e.width+(e.x-i.x),d=e.height+(e.y-i.y),{w:S,h:P}=u(l,d);e.x+=e.width-S,e.y+=e.height-P,e.width=S,e.height=P;break}case"top-right":{const{w:l,h:d}=u(o,e.height+(e.y-i.y));e.y+=e.height-d,e.width=l,e.height=d;break}case"bottom-left":{const{w:l,h:d}=u(e.width+(e.x-i.x),r);e.x+=e.width-l,e.width=l,e.height=d;break}case"bottom-right":{const{w:l,h:d}=u(o,r);e.width=l,e.height=d;break}}}function W(e,i){const n=e.getBoundingClientRect(),t=window.devicePixelRatio||1;e.width=Math.max(1,Math.floor(n.width*t)),e.height=Math.max(1,Math.floor(n.height*t)),i.setTransform(t,0,0,t,0,0)}function L(e,i,n,t,o){const{antLength:r,antSpacing:u,selectionBorderWidth:l}=o;i.clearRect(0,0,e.width,e.height),i.strokeStyle="white",i.lineWidth=l,i.setLineDash([r,u]),i.lineDashOffset=-n,i.strokeRect(t.x,t.y,t.width,t.height)}function B(e){const i=document.createElement("div");i.className="controls",i.setAttribute("aria-label","Selection controls"),i.innerHTML=`
    <label>Dash length
      <input id="ctl-antLength" type="range" min="2" max="40" step="1" value="${s.antLength}">
      <output id="out-antLength">${s.antLength}</output>
    </label>
    <label>Dash spacing
      <input id="ctl-antSpacing" type="range" min="0" max="40" step="1" value="${s.antSpacing}">
      <output id="out-antSpacing">${s.antSpacing}</output>
    </label>
    <label>Ant speed
      <input id="ctl-antSpeed" type="range" min="10" max="400" step="5" value="${s.antSpeed}">
      <output id="out-antSpeed">${s.antSpeed}</output>
    </label>
    <label>Border width
      <input id="ctl-border" type="range" min="1" max="6" step="1" value="${s.selectionBorderWidth}">
      <output id="out-border">${s.selectionBorderWidth}</output>
    </label>
    <label>Edge tolerance
      <input id="ctl-edge" type="range" min="2" max="20" step="1" value="${s.edge}">
      <output id="out-edge">${s.edge}</output>
    </label>
  `,e.querySelector(".canvas-wrap").prepend(i);const n=(t,o,r)=>{const u=i.querySelector(`#${t}`),l=i.querySelector(`#${o}`);u.addEventListener("input",()=>{const d=u.valueAsNumber;r(d),l.textContent=String(d)})};n("ctl-antLength","out-antLength",t=>s.antLength=t),n("ctl-antSpacing","out-antSpacing",t=>s.antSpacing=t),n("ctl-antSpeed","out-antSpeed",t=>s.antSpeed=t),n("ctl-border","out-border",t=>s.selectionBorderWidth=t),n("ctl-edge","out-edge",t=>s.edge=t)}const w=document.querySelector("#app");if(!w)throw new Error("#app not found");let v=performance.now(),m=0;w.innerHTML=`
  <div class="canvas-wrap">

    <canvas id="canvas" aria-label="Selection canvas"></canvas>
  </div>
`;const a=document.querySelector("#canvas"),g=a.getContext("2d");O(a,g,f);B(w);function M(){const e=performance.now(),i=(e-v)/1e3;v=e;const n=s.antSpeed,t=s.antLength+s.antSpacing;if(m=(m+n*i)%t,g.clearRect(0,0,a.width,a.height),f.startPosition&&f.currentPosition&&!f.finalSelection){const o=z(f.startPosition,f.currentPosition);L(a,g,m,o,s)}else f.finalSelection&&L(a,g,m,f.finalSelection,s);requestAnimationFrame(M)}M();W(a,g);
